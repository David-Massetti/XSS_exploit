# XSS Exploit : increased privileges
My research for an xss exploit on https://lduq-challenges-secu1.teexma.local/

### Reproduction :
 - The Teexma target runs on https://lduq-challenges-secu1.teexma.local/
 - It runs on Version 4.3.0 (Revision : 75892, Date : 10/10/2022)
 - The element on which the XSS flaw is focused is the TxBanner template banner which executes an HTML code in the banner to give it a customizable dimension.
 - It is the ObjectType Ticket that carries this Banner and will be the target of the attack.

### Use of these scripts
These scripts were used to simplify the process and only need to inject a line such as `<script src="localisationScript/script.js></script>`, which allows a modification of the script afterwards without having to touch the Teexma database. Moreover, the semicolons (;) are automatically removed from the name of the entity (and thus from the banner).

The scripts should be hosted online to be accessible to all users.

## Script n°1 : Modification of the DOM
The objective of this script is to modify the content of the web page (in particular the *body*) to make appear a connection form similar to that of Teexma making believe in a disconnection. The url being always the one of Teexma, the username and password fields will be filled by themselves. We don't recover the information here but we understand that it is very easy to recover them.

## Script n°2 : Increase of privileges
On this teexma there is an unprivileged account from which the attacker has access. It only allows him to create tickets. It is up to the second account: the administrator, to close them. The goal for the attacker is to successfully close an old ticket. To do this, he just needs to inject the second code: `reqCloture.js` in line so that the administrator, once connected to the page of the "infacted" object, makes his browser execute the code.



#### This code works in 3 parts:
**For the moment, I have only developed one of the three part  !**

The goal is to send a request to close the ticket. As we can't get the connection cookies directly because of the [httponly](https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies) and the [CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS), we'll have to use for each request to the same origin (the teexma) `"credentials": "include"` allowing to send back automatically the cookies to the website.


- The first part is a request (with `fetch`) to retrieve the CRSF token (see [here](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#synchronizer-token-pattern) for more information on this security point)
- Once this token is retrieved, the WorkFlow module must be initialized with a request. **For now, only this part is done !**
- The last part consists in sending a request to close the ticket, with the crsf token recovered at point 1 and once again the user's cookies (here the administrator).
